<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="scoringutils">
<title>Deprecated Visualisations • scoringutils</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Deprecated Visualisations">
<meta property="og:description" content="scoringutils">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">scoringutils</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/scoringutils.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Deprecated-visualisations.html">Deprecated Visualisations</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/epiforecasts/scoringutils/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Deprecated Visualisations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/scoringutils/blob/HEAD/vignettes/Deprecated-visualisations.Rmd" class="external-link"><code>vignettes/Deprecated-visualisations.Rmd</code></a></small>
      <div class="d-none name"><code>Deprecated-visualisations.Rmd</code></div>
    </div>

    
    
<p>This Vignette provides the code for visualisations that were
previously part of <code>scoringutils</code> but have been removed with
<code>scoringutils</code> version <code>2.0</code>.</p>
<p>The example data used is the data shipped with the
<code>scoringutils</code> package. It consists of short-term forecasts
of COVID-19 cases and deaths for several European countries, submitted
to the European COVID-19 Forecast Hub. Every week, forecasters submitted
1 to 4 week ahead forecasts (the “forecast horizon”, here restricted to
1 to 3 week ahead). The dates for which a forecast was made are called
<code>target_end_date</code>. See e.g. <code><a href="../reference/example_quantile.html">?example_quantile</a></code>
for more information.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://doi.org/10.48550/arXiv.2205.07090" class="external-link">scoringutils</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/" class="external-link">ggdist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span> <span class="co">#pipe operator</span></span></code></pre></div>
<div class="section level2">
<h2 id="functions-plot_predictions-and-make_na">Functions <code>plot_predictions()</code> and
<code>make_na()</code><a class="anchor" aria-label="anchor" href="#functions-plot_predictions-and-make_na"></a>
</h2>
<p>In previous versions of <code>scoringutils</code>, forecasts and
observed values could be visualised using the function
<code>plot_predictions()</code> and its <code>make_na()</code> helper
function. The following shows the function code first and then an
example.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#" @title Plot Predictions vs True Values</span></span>
<span><span class="co">#"</span></span>
<span><span class="co">#" @description</span></span>
<span><span class="co">#" Make a plot of observed and predicted values</span></span>
<span><span class="co">#"</span></span>
<span><span class="co">#" @param data a data.frame that follows the same specifications outlined in</span></span>
<span><span class="co">#" [score()]. To customise your plotting, you can filter your data using the</span></span>
<span><span class="co">#" function [make_NA()].</span></span>
<span><span class="co">#" @param by character vector with column names that denote categories by which</span></span>
<span><span class="co">#" the plot should be stratified. If for example you want to have a facetted</span></span>
<span><span class="co">#" plot, this should be a character vector with the columns used in facetting</span></span>
<span><span class="co">#" (note that the facetting still needs to be done outside of the function call)</span></span>
<span><span class="co">#" @param x character vector of length one that denotes the name of the variable</span></span>
<span><span class="co">#" @param interval_range numeric vector indicating the interval ranges to plot.</span></span>
<span><span class="co">#" If 0 is included in `interval_range`, the median prediction will be shown.</span></span>
<span><span class="co">#" @return ggplot object with a plot of true vs predicted values</span></span>
<span><span class="co">#" @importFrom ggplot2 ggplot scale_colour_manual scale_fill_manual theme_light</span></span>
<span><span class="co">#" @importFrom ggplot2 facet_wrap facet_grid aes geom_line .data geom_point</span></span>
<span><span class="co">#" @importFrom data.table dcast</span></span>
<span><span class="co">#" @importFrom ggdist geom_lineribbon</span></span>
<span><span class="co">#" @export</span></span>
<span><span class="co">#" @examples</span></span>
<span><span class="co">#" library(ggplot2)</span></span>
<span><span class="co">#" library(magrittr)</span></span>
<span><span class="co">#"</span></span>
<span><span class="co">#" example_continuous %&gt;%</span></span>
<span><span class="co">#"   make_NA (</span></span>
<span><span class="co">#"     what = "truth",</span></span>
<span><span class="co">#"     target_end_date &gt;= "2021-07-22",</span></span>
<span><span class="co">#"     target_end_date &lt; "2021-05-01"</span></span>
<span><span class="co">#"   ) %&gt;%</span></span>
<span><span class="co">#"   make_NA (</span></span>
<span><span class="co">#"     what = "forecast",</span></span>
<span><span class="co">#"     model != "EuroCOVIDhub-ensemble",</span></span>
<span><span class="co">#"     forecast_date != "2021-06-07"</span></span>
<span><span class="co">#"   ) %&gt;%</span></span>
<span><span class="co">#"   plot_predictions (</span></span>
<span><span class="co">#"     x = "target_end_date",</span></span>
<span><span class="co">#"     by = c("target_type", "location"),</span></span>
<span><span class="co">#"     interval_range = c(0, 50, 90, 95)</span></span>
<span><span class="co">#"   ) +</span></span>
<span><span class="co">#"   facet_wrap(~ location + target_type, scales = "free_y") +</span></span>
<span><span class="co">#"   aes(fill = model, color = model)</span></span>
<span><span class="co">#"</span></span>
<span><span class="co">#" example_continuous %&gt;%</span></span>
<span><span class="co">#"   make_NA (</span></span>
<span><span class="co">#"     what = "truth",</span></span>
<span><span class="co">#"     target_end_date &gt;= "2021-07-22",</span></span>
<span><span class="co">#"     target_end_date &lt; "2021-05-01"</span></span>
<span><span class="co">#"   ) %&gt;%</span></span>
<span><span class="co">#"   make_NA (</span></span>
<span><span class="co">#"     what = "forecast",</span></span>
<span><span class="co">#"     forecast_date != "2021-06-07"</span></span>
<span><span class="co">#"   ) %&gt;%</span></span>
<span><span class="co">#"   plot_predictions (</span></span>
<span><span class="co">#"     x = "target_end_date",</span></span>
<span><span class="co">#"     by = c("target_type", "location"),</span></span>
<span><span class="co">#"     interval_range = 0</span></span>
<span><span class="co">#"   ) +</span></span>
<span><span class="co">#"   facet_wrap(~ location + target_type, scales = "free_y") +</span></span>
<span><span class="co">#"   aes(fill = model, color = model)</span></span>
<span></span>
<span><span class="va">plot_predictions</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>,</span>
<span>                             <span class="va">by</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                             <span class="va">x</span> <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>                             <span class="va">interval_range</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># split truth data and forecasts in order to apply different filtering</span></span>
<span>  <span class="va">truth_data</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">observed</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">forecasts</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">del_cols</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">truth_data</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">truth_data</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">by</span>, <span class="st">"observed"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">truth_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="va">truth_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">del_cols</span><span class="op">)</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># find out what type of predictions we have. convert sample based to</span></span>
<span>  <span class="co"># interval range data</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/get_forecast_type.html">get_forecast_type</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"quantile"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">forecasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantile_to_interval.html">quantile_to_interval</a></span><span class="op">(</span></span>
<span>      <span class="va">forecasts</span>,</span>
<span>      keep_quantile_col <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/get_forecast_type.html">get_forecast_type</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"sample"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># using a scoringutils internal function</span></span>
<span>    <span class="va">forecasts</span> <span class="op">&lt;-</span> <span class="fu">scoringutils</span><span class="fu">:::</span><span class="fu"><a href="../reference/sample_to_interval_long.html">sample_to_interval_long</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/as_forecast.html">as_forecast</a></span><span class="op">(</span><span class="va">forecasts</span><span class="op">)</span>,</span>
<span>      interval_range <span class="op">=</span> <span class="va">interval_range</span>,</span>
<span>      keep_quantile_col <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># select appropriate boundaries and pivot wider</span></span>
<span>  <span class="va">select</span> <span class="op">&lt;-</span> <span class="va">forecasts</span><span class="op">$</span><span class="va">interval_range</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">interval_range</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">intervals</span> <span class="op">&lt;-</span> <span class="va">forecasts</span><span class="op">[</span><span class="va">select</span>, <span class="op">]</span></span>
<span></span>
<span>  <span class="co"># delete quantile column in intervals if present. This is important for</span></span>
<span>  <span class="co"># pivoting</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"quantile_level"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">intervals</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">intervals</span><span class="op">[</span>, <span class="va">quantile_level</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/theme_scoringutils.html">theme_scoringutils</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"True and predicted values"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">intervals</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># pivot wider and convert range to a factor</span></span>
<span>    <span class="va">intervals</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/dcast.data.table.html" class="external-link">dcast</a></span><span class="op">(</span><span class="va">intervals</span>, <span class="va">...</span> <span class="op">~</span> <span class="va">boundary</span>,</span>
<span>                                   value.var <span class="op">=</span> <span class="st">"predicted"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># only plot interval ranges if there are interval ranges to plot</span></span>
<span>    <span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">plot</span> <span class="op">+</span></span>
<span>      <span class="fu">ggdist</span><span class="fu">::</span><span class="fu"><a href="http://mjskay.github.io/ggdist/reference/geom_lineribbon.html" class="external-link">geom_lineribbon</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">intervals</span>,</span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>          ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>,</span>
<span>          <span class="co"># We use the fill_ramp aesthetic for this instead of the default fill</span></span>
<span>          <span class="co"># because we want to keep fill to be able to use it for other</span></span>
<span>          <span class="co"># variables</span></span>
<span>          fill_ramp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">interval_range</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">interval_range</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        lwd <span class="op">=</span> <span class="fl">0.4</span></span>
<span>      <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">ggdist</span><span class="fu">::</span><span class="fu"><a href="http://mjskay.github.io/ggdist/reference/scale_colour_ramp.html" class="external-link">scale_fill_ramp_discrete</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"interval_range"</span>,</span>
<span>        <span class="co"># range argument was added to make sure that the line for the median</span></span>
<span>        <span class="co"># and the ribbon don"t have the same opacity, making the line</span></span>
<span>        <span class="co"># invisible</span></span>
<span>        range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># We could treat this step as part of ggdist::geom_lineribbon() but we treat</span></span>
<span>  <span class="co"># it separately here to deal with the case when only the median is provided</span></span>
<span>  <span class="co"># (in which case ggdist::geom_lineribbon() will fail)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fl">0</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">interval_range</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">select_median</span> <span class="op">&lt;-</span></span>
<span>      <span class="va">forecasts</span><span class="op">$</span><span class="va">interval_range</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">forecasts</span><span class="op">$</span><span class="va">boundary</span> <span class="op">==</span> <span class="st">"lower"</span></span>
<span>    <span class="va">median</span> <span class="op">&lt;-</span> <span class="va">forecasts</span><span class="op">[</span><span class="va">select_median</span><span class="op">]</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">median</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">plot</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>          data <span class="op">=</span> <span class="va">median</span>,</span>
<span>          mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">predicted</span><span class="op">)</span>,</span>
<span>          lwd <span class="op">=</span> <span class="fl">0.4</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># add observed values</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">truth_data</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">plot</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">truth_data</span>,</span>
<span>        show.legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">observed</span><span class="op">)</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">0.5</span></span>
<span>      <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">truth_data</span>,</span>
<span>        inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        show.legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">observed</span><span class="op">)</span>,</span>
<span>        linetype <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>        lwd <span class="op">=</span> <span class="fl">0.2</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><code>plot_predictions()</code> does the actual work of producing a
plot. The <code>by</code> argument is needed so that the user can facet
the plot correctly and the user needs to specify all columns relevant
for facetting. <code>make_NA()</code> represents a form of filtering,
but instead of filtering entire rows, the relevant entries in the
columns “predicted” or “observed” are made <code>NA</code>. This allows
the user to filter observations and forecasts independently.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#" @title Make Rows NA in Data for Plotting</span></span>
<span><span class="co">#"</span></span>
<span><span class="co">#" @description</span></span>
<span><span class="co">#" Filters the data and turns values into `NA` before the data gets passed to</span></span>
<span><span class="co">#" [plot_predictions()]. The reason to do this is to this is that it allows to</span></span>
<span><span class="co">#" "filter" prediction and truth data separately. Any value that is NA will then</span></span>
<span><span class="co">#" be removed in the subsequent call to [plot_predictions()].</span></span>
<span><span class="co">#"</span></span>
<span><span class="co">#" @inheritParams score</span></span>
<span><span class="co">#" @param what character vector that determines which values should be turned</span></span>
<span><span class="co">#" into `NA`. If `what = "truth"`, values in the column "observed" will be</span></span>
<span><span class="co">#" turned into `NA`. If `what = "forecast"`, values in the column "prediction"</span></span>
<span><span class="co">#" will be turned into `NA`. If `what = "both"`, values in both column will be</span></span>
<span><span class="co">#" turned into `NA`.</span></span>
<span><span class="co">#" @param ... logical statements used to filter the data</span></span>
<span><span class="co">#" @return A data.table</span></span>
<span><span class="co">#" @importFrom rlang enexprs</span></span>
<span><span class="co">#" @keywords plotting</span></span>
<span><span class="co">#" @export</span></span>
<span><span class="co">#"</span></span>
<span><span class="co">#" @examples</span></span>
<span><span class="co">#" make_NA (</span></span>
<span><span class="co">#"     example_continuous,</span></span>
<span><span class="co">#"     what = "truth",</span></span>
<span><span class="co">#"     target_end_date &gt;= "2021-07-22",</span></span>
<span><span class="co">#"     target_end_date &lt; "2021-05-01"</span></span>
<span><span class="co">#"   )</span></span>
<span></span>
<span><span class="va">make_NA</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                    <span class="va">what</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"truth"</span>, <span class="st">"forecast"</span>, <span class="st">"both"</span><span class="op">)</span>,</span>
<span>                    <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  <span class="va">what</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">what</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># turn ... arguments into expressions</span></span>
<span>  <span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">enexprs</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">vars</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">what</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"forecast"</span>, <span class="st">"both"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span>, <span class="st">"predicted"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">what</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"truth"</span>, <span class="st">"both"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span>, <span class="st">"observed"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">expr</span> <span class="kw">in</span> <span class="va">args</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">expr</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">vars</span><span class="op">)</span> <span class="op">:=</span> <span class="cn">NA_real_</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In the following are a few examples of using the two functions to
create a plot using the scoringutils example data.</p>
<p>Visualising the median forecasts for the example data. The truth data
is restricted to a period between 2021-05-01 and 2021-07-22. The
forecast data is a forecast from the model “EuroCOVIDhub-ensemble” made
on the “2021-06-07”. All other data is set to <code>NA</code>,
effectively removing it from the plot.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">median_forecasts</span> <span class="op">&lt;-</span> <span class="va">example_quantile</span><span class="op">[</span><span class="va">quantile_level</span> <span class="op">==</span> <span class="fl">0.5</span><span class="op">]</span></span>
<span><span class="va">median_forecasts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">make_NA</span><span class="op">(</span>what <span class="op">=</span> <span class="st">"truth"</span>,</span>
<span>          <span class="va">target_end_date</span> <span class="op">&lt;=</span> <span class="st">"2021-05-01"</span>,</span>
<span>          <span class="va">target_end_date</span> <span class="op">&gt;</span> <span class="st">"2021-07-22"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">make_NA</span><span class="op">(</span>what <span class="op">=</span> <span class="st">"forecast"</span>,</span>
<span>          <span class="va">model</span> <span class="op">!=</span> <span class="st">"EuroCOVIDhub-ensemble"</span>,</span>
<span>          <span class="va">forecast_date</span> <span class="op">!=</span> <span class="st">"2021-06-07"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">plot_predictions</span><span class="op">(</span></span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"location"</span>, <span class="st">"target_type"</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"target_end_date"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">location</span> <span class="op">~</span> <span class="va">target_type</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Deprecated-visualisations_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>This is the same plot, but with a variety of prediction intervals
shown, instead of just the median.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_quantile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">make_NA</span><span class="op">(</span>what <span class="op">=</span> <span class="st">"truth"</span>,</span>
<span>          <span class="va">target_end_date</span> <span class="op">&lt;=</span> <span class="st">"2021-05-01"</span>,</span>
<span>          <span class="va">target_end_date</span> <span class="op">&gt;</span> <span class="st">"2021-07-22"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">make_NA</span><span class="op">(</span>what <span class="op">=</span> <span class="st">"forecast"</span>,</span>
<span>          <span class="va">model</span> <span class="op">!=</span> <span class="st">"EuroCOVIDhub-ensemble"</span>,</span>
<span>          <span class="va">forecast_date</span> <span class="op">!=</span> <span class="st">"2021-06-07"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">plot_predictions</span><span class="op">(</span></span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"location"</span>, <span class="st">"target_type"</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"target_end_date"</span>,</span>
<span>    interval_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">60</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">location</span> <span class="op">~</span> <span class="va">target_type</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Deprecated-visualisations_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>And a similar plot, this time based on continuous forecasts. The
predictions are automatically converted to a quantile-based forecasts
for plotting.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_continuous</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">make_NA</span><span class="op">(</span>what <span class="op">=</span> <span class="st">"truth"</span>,</span>
<span>          <span class="va">target_end_date</span> <span class="op">&lt;=</span> <span class="st">"2021-05-01"</span>,</span>
<span>          <span class="va">target_end_date</span> <span class="op">&gt;</span> <span class="st">"2021-07-22"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">make_NA</span><span class="op">(</span>what <span class="op">=</span> <span class="st">"forecast"</span>,</span>
<span>          <span class="va">model</span> <span class="op">!=</span> <span class="st">"EuroCOVIDhub-ensemble"</span>,</span>
<span>          <span class="va">forecast_date</span> <span class="op">!=</span> <span class="st">"2021-06-07"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">plot_predictions</span><span class="op">(</span></span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"location"</span>, <span class="st">"target_type"</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"target_end_date"</span>,</span>
<span>    interval_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span>, <span class="fl">90</span>, <span class="fl">95</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">location</span> <span class="op">~</span> <span class="va">target_type</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Deprecated-visualisations_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Displaying two forecasts at a time with additional colours:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_quantile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">make_NA</span><span class="op">(</span>what <span class="op">=</span> <span class="st">"truth"</span>,</span>
<span>          <span class="va">target_end_date</span> <span class="op">&gt;</span> <span class="st">"2021-07-15"</span>,</span>
<span>          <span class="va">target_end_date</span> <span class="op">&lt;=</span> <span class="st">"2021-05-22"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">make_NA</span><span class="op">(</span>what <span class="op">=</span> <span class="st">"forecast"</span>,</span>
<span>          <span class="op">!</span><span class="op">(</span><span class="va">model</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EuroCOVIDhub-ensemble"</span>, <span class="st">"EuroCOVIDhub-baseline"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          <span class="va">forecast_date</span> <span class="op">!=</span> <span class="st">"2021-06-28"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">plot_predictions</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"target_end_date"</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"target_type"</span>, <span class="st">"location"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">model</span>, fill <span class="op">=</span> <span class="va">model</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">target_type</span> <span class="op">~</span> <span class="va">location</span>, ncol <span class="op">=</span> <span class="fl">4</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Target end date"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Deprecated-visualisations_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="function-plot_interval_ranges-formerly-plot_ranges">Function <code>plot_interval_ranges()</code> (formerly
<code>plot_ranges()</code>)<a class="anchor" aria-label="anchor" href="#function-plot_interval_ranges-formerly-plot_ranges"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#" @title Plot Metrics by Range of the Prediction Interval</span></span>
<span><span class="co">#"</span></span>
<span><span class="co">#" @description</span></span>
<span><span class="co">#" Visualise the metrics by range, e.g. if you are interested how different</span></span>
<span><span class="co">#" interval ranges contribute to the overall interval score, or how</span></span>
<span><span class="co">#" sharpness / dispersion changes by range.</span></span>
<span><span class="co">#"</span></span>
<span><span class="co">#" @param scores A data.frame of scores based on quantile forecasts as</span></span>
<span><span class="co">#" produced by [score()] or [summarise_scores()]. Note that "range" must be included</span></span>
<span><span class="co">#" in the `by` argument when running [summarise_scores()]</span></span>
<span><span class="co">#" @param y The variable from the scores you want to show on the y-Axis.</span></span>
<span><span class="co">#" This could be something like "wis" (the default) or "dispersion"</span></span>
<span><span class="co">#" @param x The variable from the scores you want to show on the x-Axis.</span></span>
<span><span class="co">#" Usually this will be "model"</span></span>
<span><span class="co">#" @param colour Character vector of length one used to determine a variable</span></span>
<span><span class="co">#" for colouring dots. The Default is "range".</span></span>
<span><span class="co">#" @return A ggplot2 object showing a contributions from the three components of</span></span>
<span><span class="co">#" the weighted interval score</span></span>
<span><span class="co">#" @importFrom ggplot2 ggplot aes aes geom_point geom_line</span></span>
<span><span class="co">#" expand_limits theme theme_light element_text scale_color_continuous labs</span></span>
<span><span class="co">#" @export</span></span>
<span><span class="co">#" @examples</span></span>
<span><span class="co">#" library(ggplot2)</span></span>
<span><span class="co">#" ex &lt;- data.table::copy(example_quantile)</span></span>
<span><span class="co">#" ex$range &lt;- scoringutils:::get_range_from_quantile(ex$quantile)</span></span>
<span><span class="co">#" scores &lt;- suppressWarnings(score(as_forecast(ex), metrics = list("wis" = wis)))</span></span>
<span><span class="co">#" summarised &lt;- summarise_scores(</span></span>
<span><span class="co">#"   scores,</span></span>
<span><span class="co">#"   by = c("model", "target_type", "range")</span></span>
<span><span class="co">#" )</span></span>
<span><span class="co">#" plot_interval_ranges(summarised, x = "model") +</span></span>
<span><span class="co">#"   facet_wrap(~target_type, scales = "free")</span></span>
<span></span>
<span><span class="va">plot_interval_ranges</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">scores</span>,</span>
<span>                                 <span class="va">y</span> <span class="op">=</span> <span class="st">"wis"</span>,</span>
<span>                                 <span class="va">x</span> <span class="op">=</span> <span class="st">"model"</span>,</span>
<span>                                 <span class="va">colour</span> <span class="op">=</span> <span class="st">"range"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="va">scores</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      y <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">y</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">colour</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">range</span><span class="op">)</span>,</span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      linewidth <span class="op">=</span> <span class="fl">0.01</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_color_continuous</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"steelblue"</span>, high <span class="op">=</span> <span class="st">"salmon"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/theme_scoringutils.html">theme_scoringutils</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      legend.position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>      axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span></span>
<span>        angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        hjust <span class="op">=</span> <span class="fl">1</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The functionality currently relies on a hack. In previous versions of
<code>scoringutils</code>, scores were computed per interval range/per
quantile. Now, <code>scoringutils</code> returns one score per forecast,
not per interval range/quantile. We therefore need to add a
<code>range</code> column, using an internal function
<code><a href="../reference/get_range_from_quantile.html">get_range_from_quantile()</a></code>. This column will be interpreted
as one that defines the unit of a single forecast by
<code>scoringutils</code>. It also means that we will get a warning
about different number of quantile levels for different forecasts
(because the 0% prediction interval only has one median forecast, while
all other prediction intervals have two (a lower and an upper
bound)).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">range_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">example_quantile</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">.</span><span class="op">[</span>, <span class="va">range</span> <span class="op">:=</span> <span class="fu">scoringutils</span><span class="fu">:::</span><span class="fu"><a href="../reference/get_range_from_quantile.html">get_range_from_quantile</a></span><span class="op">(</span><span class="va">quantile_level</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">sum_scores</span> <span class="op">&lt;-</span> <span class="va">range_example</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/as_forecast.html">as_forecast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/score.html">score</a></span><span class="op">(</span>metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wis <span class="op">=</span> <span class="va">wis</span>, dispersion <span class="op">=</span> <span class="va">dispersion</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarise_scores.html">summarise_scores</a></span><span class="op">(</span>by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"target_type"</span>, <span class="st">"range"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_interval_ranges</span><span class="op">(</span><span class="va">sum_scores</span>, x <span class="op">=</span> <span class="st">"model"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">target_type</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Deprecated-visualisations_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Plotting dispersion instead of WIS:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_interval_ranges</span><span class="op">(</span><span class="va">sum_scores</span>, y <span class="op">=</span> <span class="st">"dispersion"</span>, x <span class="op">=</span> <span class="st">"model"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">target_type</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Deprecated-visualisations_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="function-plot_score_table">Function <code>plot_score_table()</code><a class="anchor" aria-label="anchor" href="#function-plot_score_table"></a>
</h2>
<p>This function allowed users to turn a table of (summarised) scores
into a coloured table. The function had hard-coded information about
what colour scale to pick for each metric. With scoringutils 2.0.0, we
allowed users to assign their own names to metrics or use custom scoring
functions. If you only stick to the default names provided by
scoringutils, the function should still work. However, the functionality
is not easily generalisable, so we decided to deprecate the
function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Plot Coloured Score Table</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @description</span></span>
<span><span class="co">#' Plots a coloured table of summarised scores obtained using</span></span>
<span><span class="co">#' [score()].</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param y the variable to be shown on the y-axis. Instead of a single character string,</span></span>
<span><span class="co">#' you can also specify a vector with column names, e.g.</span></span>
<span><span class="co">#' `y = c("model", "location")`. These column names will be concatenated</span></span>
<span><span class="co">#' to create a unique row identifier (e.g. "model1_location1").</span></span>
<span><span class="co">#' @param by A character vector that determines how the colour shading for the</span></span>
<span><span class="co">#' plot gets computed. By default (`NULL`), shading will be determined per</span></span>
<span><span class="co">#' metric, but you can provide additional column names (see examples).</span></span>
<span><span class="co">#' @param metrics A character vector with the metrics to show. If set to</span></span>
<span><span class="co">#' `NULL` (default), all metrics present in `scores` will be shown.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A ggplot object with a coloured table of summarised scores</span></span>
<span><span class="co">#' @inheritParams get_pairwise_comparisons</span></span>
<span><span class="co">#' @importFrom ggplot2 ggplot aes element_blank element_text labs coord_cartesian coord_flip</span></span>
<span><span class="co">#' @importFrom data.table setDT melt</span></span>
<span><span class="co">#' @importFrom stats sd</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' library(ggplot2)</span></span>
<span><span class="co">#' library(magrittr) # pipe operator</span></span>
<span><span class="co">#' \dontshow{</span></span>
<span><span class="co">#'   data.table::setDTthreads(2) # restricts number of cores used on CRAN</span></span>
<span><span class="co">#' }</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' scores &lt;- score(as_forecast(example_quantile)) %&gt;%</span></span>
<span><span class="co">#'   summarise_scores(by = c("model", "target_type")) %&gt;%</span></span>
<span><span class="co">#'   summarise_scores(by = c("model", "target_type"), fun = signif, digits = 2)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' plot_score_table(scores, y = "model", by = "target_type") +</span></span>
<span><span class="co">#'   facet_wrap(~target_type, ncol = 1)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' # can also put target description on the y-axis</span></span>
<span><span class="co">#' plot_score_table(scores,</span></span>
<span><span class="co">#'                  y = c("model", "target_type"),</span></span>
<span><span class="co">#'                  by = "target_type")</span></span>
<span></span>
<span><span class="va">plot_score_table</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">scores</span>,</span>
<span>                             <span class="va">y</span> <span class="op">=</span> <span class="st">"model"</span>,</span>
<span>                             <span class="va">by</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                             <span class="va">metrics</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># identify metrics -----------------------------------------------------------</span></span>
<span>  <span class="va">id_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_forecast_unit.html">get_forecast_unit</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span></span>
<span>  <span class="va">metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_metrics.html">get_metrics</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">cols_to_delete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">metrics</span>, <span class="va">id_vars</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="va">scores</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">cols_to_delete</span><span class="op">)</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># compute scaled values ------------------------------------------------------</span></span>
<span>  <span class="co"># scaling is done in order to colour the different scores</span></span>
<span>  <span class="co"># for most metrics larger is worse, but others like bias are better if they</span></span>
<span>  <span class="co"># are close to zero and deviations in both directions are bad</span></span>
<span></span>
<span>  <span class="co"># define which metrics are scaled using min (larger is worse) and</span></span>
<span>  <span class="co"># which not (metrics like bias where deviations in both directions are bad)</span></span>
<span>  <span class="va">metrics_zero_good</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bias"</span>, <span class="st">"interval_coverage_deviation"</span><span class="op">)</span></span>
<span>  <span class="va">metrics_no_color</span> <span class="op">&lt;-</span> <span class="st">"coverage"</span></span>
<span></span>
<span>  <span class="va">metrics_min_good</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">metrics</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">metrics_zero_good</span>, <span class="va">metrics_no_color</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># write scale functions that can be used in data.table</span></span>
<span>  <span class="va">scale</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">scaled</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">scaled</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">scale_min_good</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">scaled</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">scaled</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># pivot longer and add scaled values</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">scores</span>,</span>
<span>    value.vars <span class="op">=</span> <span class="va">metrics</span>,</span>
<span>    id.vars <span class="op">=</span> <span class="va">id_vars</span>,</span>
<span>    variable.name <span class="op">=</span> <span class="st">"metric"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">df</span><span class="op">[</span><span class="va">metric</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">metrics_min_good</span>, <span class="va">value_scaled</span> <span class="op">:=</span> <span class="fu">scale_min_good</span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"metric"</span>, <span class="va">by</span><span class="op">)</span></span>
<span>  <span class="op">]</span></span>
<span>  <span class="va">df</span><span class="op">[</span><span class="va">metric</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">metrics_zero_good</span>, <span class="va">value_scaled</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"metric"</span>, <span class="va">by</span><span class="op">)</span></span>
<span>  <span class="op">]</span></span>
<span>  <span class="va">df</span><span class="op">[</span><span class="va">metric</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">metrics_no_color</span>, <span class="va">value_scaled</span> <span class="op">:=</span> <span class="fl">0</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"metric"</span>, <span class="va">by</span><span class="op">)</span></span>
<span>  <span class="op">]</span></span>
<span></span>
<span>  <span class="co"># create identifier column for plot ------------------------------------------</span></span>
<span>  <span class="co"># if there is only one column, leave column as is. Reason to do that is that</span></span>
<span>  <span class="co"># users can then pass in a factor and keep the ordering of that column intact</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">df</span><span class="op">[</span>, <span class="va">identifCol</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">paste</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.SD</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       .SDcols <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="va">y</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">df</span>, old <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, new <span class="op">=</span> <span class="st">"identifCol"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># plot -----------------------------------------------------------------------</span></span>
<span>  <span class="co"># make plot with all metrics that are not NA</span></span>
<span>  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="va">df</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, <span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">identifCol</span>, x <span class="op">=</span> <span class="va">metric</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value_scaled</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"white"</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">identifCol</span>, label <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"steelblue"</span>, high <span class="op">=</span> <span class="st">"salmon"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/theme_scoringutils.html">theme_scoringutils</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>      axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span></span>
<span>        angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        hjust <span class="op">=</span> <span class="fl">1</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The main functionality the old function provided, was scaling the
scores in order to obtain reasonable colour shades. It would do this per
metric, but one could also pass in additional grouping variables through
the <code>by</code> argument. This allowed users to achieve a faceting
of the table (note that of course scores also needed to be summarised
according to the same grouping).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/score.html">score</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_forecast.html">as_forecast</a></span><span class="op">(</span><span class="va">example_quantile</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarise_scores.html">summarise_scores</a></span><span class="op">(</span>by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"target_type"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarise_scores.html">summarise_scores</a></span><span class="op">(</span>by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"target_type"</span><span class="op">)</span>, fun <span class="op">=</span> <span class="va">signif</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Some rows containing NA values may be removed. This is fine if not</span></span>
<span><span class="co">#&gt;   unexpected.</span></span>
<span></span>
<span><span class="fu">plot_score_table</span><span class="op">(</span><span class="va">scores</span>, y <span class="op">=</span> <span class="st">"model"</span>, by <span class="op">=</span> <span class="st">"target_type"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">target_type</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Deprecated-visualisations_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>The function also allowed users to combine different facets into one,
by creating a combined y-variable. This was done by passing a vector of
column names to the <code>y</code> argument.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># can also put target description on the y-axis</span></span>
<span><span class="fu">plot_score_table</span><span class="op">(</span><span class="va">scores</span>,</span>
<span>                 y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"target_type"</span><span class="op">)</span>,</span>
<span>                 by <span class="op">=</span> <span class="st">"target_type"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Deprecated-visualisations_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://followtheargument.org/" class="external-link">Nikos Bosse</a>, <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Hugo Gruson, Sebastian Funk.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
