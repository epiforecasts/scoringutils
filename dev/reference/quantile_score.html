<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Quantile score — quantile_score • scoringutils</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quantile score — quantile_score"><meta name="description" content="Proper Scoring Rule to score quantile predictions. Smaller values are better.
The quantile score is closely related to the interval score (see wis()) and
is the quantile equivalent that works with single quantiles instead of
central prediction intervals.
The quantile score, also called pinball loss, for a single quantile
level \(\tau\) is defined as
$$
  \text{QS}_\tau(F, y) = 2 \cdot \{ \mathbf{1}(y \leq q_\tau) - \tau\} \cdot (q_\tau − y) =
  \begin{cases}
2 \cdot (1 - \tau) * q_\tau - y,       &amp;amp; \text{if } y \leq q_\tau\\
2 \cdot \tau * |q_\tau - y|,           &amp;amp; \text{if } y &amp;gt; q_\tau,
\end{cases}
$$
with \(q_\tau\) being the \(\tau\)-quantile of the predictive
distribution \(F\), and \(\mathbf{1}(\cdot)\) the indicator function.
The weighted interval score for a single prediction interval can be obtained
as the average of the quantile scores for the lower and upper quantile of
that prediction interval:
$$
  \text{WIS}_\alpha(F, y) = \frac{\text{QS}_{\alpha/2}(F, y)
  + \text{QS}_{1 - \alpha/2}(F, y)}{2}.
$$
See the SI of Bracher et al. (2021) for more details.
quantile_score() returns the average quantile score across the quantile
levels provided. For a set of quantile levels that form pairwise central
prediction intervals, the quantile score is equivalent to the interval score."><meta property="og:description" content="Proper Scoring Rule to score quantile predictions. Smaller values are better.
The quantile score is closely related to the interval score (see wis()) and
is the quantile equivalent that works with single quantiles instead of
central prediction intervals.
The quantile score, also called pinball loss, for a single quantile
level \(\tau\) is defined as
$$
  \text{QS}_\tau(F, y) = 2 \cdot \{ \mathbf{1}(y \leq q_\tau) - \tau\} \cdot (q_\tau − y) =
  \begin{cases}
2 \cdot (1 - \tau) * q_\tau - y,       &amp;amp; \text{if } y \leq q_\tau\\
2 \cdot \tau * |q_\tau - y|,           &amp;amp; \text{if } y &amp;gt; q_\tau,
\end{cases}
$$
with \(q_\tau\) being the \(\tau\)-quantile of the predictive
distribution \(F\), and \(\mathbf{1}(\cdot)\) the indicator function.
The weighted interval score for a single prediction interval can be obtained
as the average of the quantile scores for the lower and upper quantile of
that prediction interval:
$$
  \text{WIS}_\alpha(F, y) = \frac{\text{QS}_{\alpha/2}(F, y)
  + \text{QS}_{1 - \alpha/2}(F, y)}{2}.
$$
See the SI of Bracher et al. (2021) for more details.
quantile_score() returns the average quantile score across the quantile
levels provided. For a set of quantile levels that form pairwise central
prediction intervals, the quantile score is equivalent to the interval score."><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a class="navbar-brand me-2" href="../index.html">scoringutils</a>
    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.2.9000</small>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://raw.githubusercontent.com/epiforecasts/scoringutils/main/inst/manuscript/manuscript.pdf">scoringutils paper</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Deprecated-functions.html">Deprecated functions</a></li>
    <li><a class="dropdown-item" href="../articles/Deprecated-visualisations.html">Deprecated Visualisations</a></li>
    <li><a class="dropdown-item" href="../articles/scoring-rules.html">Scoring rules in `scoringutils`</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/scoringutils/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <h1>Quantile score</h1>
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/scoringutils/blob/main/R/metrics-quantile.R" class="external-link"><code>R/metrics-quantile.R</code></a></small>
      <div class="d-none name"><code>quantile_score.Rd</code></div>
    </div>
    <div class="ref-description section level2">
    <p>Proper Scoring Rule to score quantile predictions. Smaller values are better.
The quantile score is closely related to the interval score (see <code><a href="wis.html">wis()</a></code>) and
is the quantile equivalent that works with single quantiles instead of
central prediction intervals.</p>
<p>The quantile score, also called pinball loss, for a single quantile
level \(\tau\) is defined as
$$
  \text{QS}_\tau(F, y) = 2 \cdot \{ \mathbf{1}(y \leq q_\tau) - \tau\} \cdot (q_\tau − y) =
  \begin{cases}
2 \cdot (1 - \tau) * q_\tau - y,       &amp; \text{if } y \leq q_\tau\\
2 \cdot \tau * |q_\tau - y|,           &amp; \text{if } y &gt; q_\tau,
\end{cases}
$$
with \(q_\tau\) being the \(\tau\)-quantile of the predictive
distribution \(F\), and \(\mathbf{1}(\cdot)\) the indicator function.</p>
<p>The weighted interval score for a single prediction interval can be obtained
as the average of the quantile scores for the lower and upper quantile of
that prediction interval:
$$
  \text{WIS}_\alpha(F, y) = \frac{\text{QS}_{\alpha/2}(F, y)
  + \text{QS}_{1 - \alpha/2}(F, y)}{2}.
$$
See the SI of Bracher et al. (2021) for more details.</p>
<p><code>quantile_score()</code> returns the average quantile score across the quantile
levels provided. For a set of quantile levels that form pairwise central
prediction intervals, the quantile score is equivalent to the interval score.</p>
    </div>
    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">quantile_score</span><span class="op">(</span><span class="va">observed</span>, <span class="va">predicted</span>, <span class="va">quantile_level</span>, weigh <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>
    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
<dl><dt id="arg-observed">observed<a class="anchor" aria-label="anchor" href="#arg-observed"></a></dt>
<dd><p>Numeric vector of size n with the observed values.</p></dd>
<dt id="arg-predicted">predicted<a class="anchor" aria-label="anchor" href="#arg-predicted"></a></dt>
<dd><p>Numeric nxN matrix of predictive
quantiles, n (number of rows) being the number of forecasts (corresponding
to the number of observed values) and N
(number of columns) the number of quantiles per forecast.
If <code>observed</code> is just a single number, then predicted can just be a
vector of size N.</p></dd>
<dt id="arg-quantile-level">quantile_level<a class="anchor" aria-label="anchor" href="#arg-quantile-level"></a></dt>
<dd><p>Vector of of size N with the quantile levels
for which predictions were made.</p></dd>
<dt id="arg-weigh">weigh<a class="anchor" aria-label="anchor" href="#arg-weigh"></a></dt>
<dd><p>Logical. If <code>TRUE</code> (the default), weigh the score by
\(\alpha / 2\), so it can be averaged into an interval score that, in
the limit (for an increasing number of equally spaced quantiles/prediction
intervals), corresponds
to the CRPS. \(\alpha\) is the value that corresponds to the
(\(\alpha/2\)) or (\(1 - \alpha/2\)), i.e. it is the decimal
value that represents how much is outside a central prediction interval
(E.g. for a 90 percent central prediction interval, alpha is 0.1).</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Numeric vector of length n with the quantile score. The scores are
averaged across quantile levels if multiple quantile levels are provided
(the result of calling <code><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans()</a></code> on the matrix of quantile scores that
is computed based on the observed and predicted values).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Strictly Proper Scoring Rules, Prediction,and Estimation,
Tilmann Gneiting and Adrian E. Raftery, 2007, Journal of the American
Statistical Association, Volume 102, 2007 - Issue 477</p>
<p>Evaluating epidemic forecasts in an interval format,
Johannes Bracher, Evan L. Ray, Tilmann Gneiting and Nicholas G. Reich, 2021,
<a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1008618" class="external-link">https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1008618</a></p>
    </div>
    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span>, mean <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span>, <span class="va">observed</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="va">observed</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">qs_lower</span> <span class="op">&lt;-</span> <span class="fu">quantile_score</span><span class="op">(</span><span class="va">observed</span>,</span></span>
<span class="r-in"><span>  predicted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  quantile_level <span class="op">=</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">qs_upper</span> <span class="op">&lt;-</span> <span class="fu">quantile_score</span><span class="op">(</span><span class="va">observed</span>,</span></span>
<span class="r-in"><span>  predicted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  quantile_level <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">interval_score</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">qs_lower</span> <span class="op">+</span> <span class="va">qs_upper</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">interval_score2</span> <span class="op">&lt;-</span> <span class="fu">quantile_score</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">observed</span>,</span></span>
<span class="r-in"><span>  predicted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">lower</span>, <span class="va">upper</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  quantile_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># this is the same as the following</span></span></span>
<span class="r-in"><span><span class="fu"><a href="wis.html">wis</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">observed</span>,</span></span>
<span class="r-in"><span>  predicted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">lower</span>, <span class="va">upper</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  quantile_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0.3372449 0.3372449 0.3372449 0.3372449 0.3372449 0.3372449 0.3372449</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8] 0.3372449 0.3372449 0.3372449</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>
    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://followtheargument.org/" class="external-link">Nikos Bosse</a>, <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Hugo Gruson, Sebastian Funk.</p>
</div>
<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.9000.</p>
</div>
    </footer></div>
  </body></html>

