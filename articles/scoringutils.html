<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>scoringutils • scoringutils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="scoringutils">
<meta property="og:description" content="scoringutils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">scoringutils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/scoringutils.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/epiforecasts/scoringutils/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="scoringutils_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>scoringutils</h1>
                        <h4 class="author">Nikos Bosse</h4>
            
            <h4 class="date">2020-07-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/scoringutils/blob/master/vignettes/scoringutils.Rmd"><code>vignettes/scoringutils.Rmd</code></a></small>
      <div class="hidden name"><code>scoringutils.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The scoringutils package provides a collection of metrics and proper scoring rules that make it simple to score forecasts against the true observed values. You can either automatically score predictions using <code>eval_forecasts</code> with an appropriately shaped <code>data.frame</code> as input, or you can access the different scoring metrics directly using lower level functions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/epiforecasts/scoringutils">scoringutils</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://r-datatable.com">data.table</a></span>)
</pre></div>
</div>
<div id="scoring-forecasts-directly" class="section level1">
<h1 class="hasAnchor">
<a href="#scoring-forecasts-directly" class="anchor"></a>Scoring Forecasts Directly</h1>
<p>A variety of metrics and scoring rules can be accessed through the <code>scoringutils</code> package.</p>
<div id="bias" class="section level2">
<h2 class="hasAnchor">
<a href="#bias" class="anchor"></a>Bias</h2>
<p>The function <code>bias</code> determines bias from predictive Monte-Carlo samples, automatically recognising whether forecasts are continuous or integer valued.</p>
<p>For continuous forecasts, Bias is measured as <span class="math display">\[B_t (P_t, x_t) = 1 - 2 \cdot (P_t (x_t))\]</span></p>
<p>where <span class="math inline">\(P_t\)</span> is the empirical cumulative distribution function of the prediction for the true value <span class="math inline">\(x_t\)</span>. Computationally, <span class="math inline">\(P_t (x_t)\)</span> is just calculated as the fraction of predictive samples for <span class="math inline">\(x_t\)</span> that are smaller than <span class="math inline">\(x_t\)</span>.</p>
<p>For integer valued forecasts, Bias is measured as</p>
<p><span class="math display">\[B_t (P_t, x_t) = 1 - (P_t (x_t) + P_t (x_t + 1))\]</span></p>
<p>to adjust for the integer nature of the forecasts. In both cases, Bias can assume values between -1 and 1 and is 0 ideally.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co">## integer valued forecasts</span>
<span class="kw">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span>(<span class="fl">30</span>, lambda = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>)
<span class="kw">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span>(n = <span class="fl">30</span>, lambda = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>))
<span class="fu"><a href="../reference/bias.html">bias</a></span>(<span class="kw">true_values</span>, <span class="kw">predictions</span>)
<span class="co">#&gt;  [1] -0.710 -0.515  0.510  0.855 -0.080 -0.910  0.280  0.850 -0.740 -0.205</span>
<span class="co">#&gt; [11]  0.740 -0.705 -0.550 -0.550  0.830  0.930 -0.825  0.230 -0.375  0.365</span>
<span class="co">#&gt; [21]  0.295  0.085  0.890  0.820 -0.340  0.845 -0.345  0.505 -0.315  0.720</span>

<span class="co">## continuous forecasts</span>
<span class="kw">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">30</span>, mean = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>)
<span class="kw">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">30</span>, mean = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>))
<span class="fu"><a href="../reference/bias.html">bias</a></span>(<span class="kw">true_values</span>, <span class="kw">predictions</span>)
<span class="co">#&gt;  [1]  0.41  0.34 -0.65 -0.64  0.54 -0.62  0.13 -0.27 -0.49 -0.67  0.24 -0.28</span>
<span class="co">#&gt; [13] -0.71 -0.30  0.47  0.55 -0.88 -0.37 -0.20  0.32 -0.29 -0.75  0.12 -0.19</span>
<span class="co">#&gt; [25]  0.31  0.82  0.21  0.19 -0.79  0.50</span>
</pre></div>
</div>
<div id="sharpness" class="section level2">
<h2 class="hasAnchor">
<a href="#sharpness" class="anchor"></a>Sharpness</h2>
<p>Sharpness is the ability of the model to generate predictions within a narrow range. It is a data-independent measure, and is purely a feature of the forecasts themselves.</p>
<p>Shaprness of predictive samples corresponding to one single true value is measured as the normalised median of the absolute deviation from the median of the predictive samples. For details, see <code><a href="https://rdrr.io/r/stats/mad.html">?stats::mad</a></code></p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span>(n = <span class="fl">30</span>, lambda = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>))
<span class="fu"><a href="../reference/sharpness.html">sharpness</a></span>(<span class="kw">predictions</span>)
<span class="co">#&gt;  [1] 1.4826 1.4826 1.4826 1.4826 1.4826 2.9652 2.9652 2.9652 2.9652 4.4478</span>
<span class="co">#&gt; [11] 2.9652 2.9652 3.7065 4.4478 4.4478 4.4478 4.4478 4.4478 4.4478 4.4478</span>
<span class="co">#&gt; [21] 4.4478 4.4478 4.4478 4.4478 4.4478 5.1891 4.4478 5.9304 5.9304 5.1891</span>
</pre></div>
</div>
<div id="calibration" class="section level2">
<h2 class="hasAnchor">
<a href="#calibration" class="anchor"></a>Calibration</h2>
<p>Calibration or reliability of forecasts is the ability of a model to correctly identify its own uncertainty in making predictions. In a model with perfect calibration, the observed data at each time point look as if they came from the predictive probability distribution at that time.</p>
<p>Equivalently, one can inspect the probability integral transform of the predictive distribution at time t,</p>
<p><span class="math display">\[u_t = F_t (x_t)\]</span></p>
<p>where <span class="math inline">\(x_t\)</span> is the observed data point at time <span class="math inline">\(t \text{ in } t_1, …, t_n\)</span>, n being the number of forecasts, and <span class="math inline">\(F_t\)</span> is the (continuous) predictive cumulative probability distribution at time t. If the true probability distribution of outcomes at time t is <span class="math inline">\(G_t\)</span> then the forecasts <span class="math inline">\(F_t\)</span> are said to be ideal if <span class="math inline">\(F_t = G_t\)</span> at all times <span class="math inline">\(t\)</span>. In that case, the probabilities ut are distributed uniformly.</p>
<p>In the case of discrete outcomes such as incidence counts, the PIT is no longer uniform even when forecasts are ideal. In that case a randomised PIT can be used instead:</p>
<p><span class="math display">\[u_t = P_t(k_t) + v \cdot (P_t(k_t) - P_t(k_t - 1) )\]</span></p>
<p>where <span class="math inline">\(k_t\)</span> is the observed count, <span class="math inline">\(P_t(x)\)</span> is the predictive cumulative probability of observing incidence <span class="math inline">\(k\)</span> at time <span class="math inline">\(t\)</span>, <span class="math inline">\(P_t (-1) = 0\)</span> by definition and <span class="math inline">\(v\)</span> is standard uniform and independent of <span class="math inline">\(k\)</span>. If <span class="math inline">\(P_t\)</span> is the true cumulative probability distribution, then <span class="math inline">\(u_t\)</span> is standard uniform.</p>
<p>The function checks whether integer or continuous forecasts were provided. It then applies the (randomised) probability integral and tests the values <span class="math inline">\(u_t\)</span> for uniformity using the Anderson-Darling test.</p>
<p>As a rule of thumb, there is no evidence to suggest a forecasting model is miscalibrated if the p-value found was greater than a threshold of <span class="math inline">\(p &gt;= 0.1\)</span>, some evidence that it was miscalibrated if <span class="math inline">\(0.01 &lt; p &lt; 0.1\)</span>, and good evidence that it was miscalibrated if <span class="math inline">\(p &lt;= 0.01\)</span>. In this context it should be noted, though, that uniformity of the PIT is a necessary but not sufficient condition of calibration. It should als be noted that the test only works given sufficient samples, otherwise the Null hypothesis will often be rejected outright.</p>
</div>
<div id="continuous-ranked-probability-score-crps" class="section level2">
<h2 class="hasAnchor">
<a href="#continuous-ranked-probability-score-crps" class="anchor"></a>Continuous Ranked Probability Score (CRPS)</h2>
<p>Wrapper around the <code>crps_sample</code> function from the <code>scoringRules</code> package. For more information look at the manuals from the <code>scoringRules</code> package. The function can be used for continuous as well as integer valued forecasts. Smaller values are better.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span>(<span class="fl">30</span>, lambda = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>)
<span class="kw">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span>(n = <span class="fl">30</span>, lambda = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>))
<span class="fu"><a href="../reference/crps.html">crps</a></span>(<span class="kw">true_values</span>, <span class="kw">predictions</span>)
<span class="co">#&gt;  [1] 0.213800 0.269100 1.241875 2.963700 0.536025 1.143400 0.782000 0.617550</span>
<span class="co">#&gt;  [9] 0.771650 0.888325 0.819875 3.236125 1.308375 0.755825 3.095025 7.601800</span>
<span class="co">#&gt; [17] 1.772350 2.287050 1.683525 1.779675 3.122500 4.401350 7.753325 2.482750</span>
<span class="co">#&gt; [25] 1.805700 2.454375 1.958675 1.313625 2.162450 3.205450</span>
</pre></div>
</div>
<div id="dawid-sebastiani-score-dss" class="section level2">
<h2 class="hasAnchor">
<a href="#dawid-sebastiani-score-dss" class="anchor"></a>Dawid-Sebastiani Score (DSS)</h2>
<p>Wrapper around the <code>dss_sample</code> function from the <code>scoringRules</code> package. For more information look at the manuals from the <code>scoringRules</code> package. The function can be used for continuous as well as integer valued forecasts. Smaller values are better.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span>(<span class="fl">30</span>, lambda = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>)
<span class="kw">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span>(n = <span class="fl">30</span>, lambda = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>))
<span class="fu"><a href="../reference/dss.html">dss</a></span>(<span class="kw">true_values</span>, <span class="kw">predictions</span>)
<span class="co">#&gt;  [1] 0.7910376 0.8241818 2.1864639 1.7675106 2.0127397 2.3201857 2.3935601</span>
<span class="co">#&gt;  [8] 3.8596371 2.0726124 2.5771267 2.2742360 2.9152518 7.6870860 2.6271188</span>
<span class="co">#&gt; [15] 3.2761646 9.3009987 2.9386330 4.5416352 4.0368861 2.9883638 4.0194273</span>
<span class="co">#&gt; [22] 3.0213152 3.4945268 3.1583928 3.1276503 3.5136267 4.7196262 3.3520072</span>
<span class="co">#&gt; [29] 3.7142495 5.5574384</span>
</pre></div>
</div>
<div id="log-score" class="section level2">
<h2 class="hasAnchor">
<a href="#log-score" class="anchor"></a>Log Score</h2>
<p>Wrapper around the <code>log_sample</code> function from the <code>scoringRules</code> package. For more information look at the manuals from the <code>scoringRules</code> package. The function should not be used for integer valued forecasts. While Log Scores are in principle possible for integer valued foreasts they require a kernel density estimate which is not well defined for discrete values. Smaller values are better.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">30</span>, mean = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>)
<span class="kw">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(n = <span class="fl">30</span>, mean = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>))
<span class="fu"><a href="../reference/logs.html">logs</a></span>(<span class="kw">true_values</span>, <span class="kw">predictions</span>)
<span class="co">#&gt;  [1] 1.5345101 1.5531096 1.4097072 1.4872590 2.0217581 1.0593383 1.1777827</span>
<span class="co">#&gt;  [8] 1.4216780 0.9499146 0.9791525 0.9691658 2.3030523 1.0301705 1.5881079</span>
<span class="co">#&gt; [15] 1.7480729 1.4190301 5.4778795 3.7302555 1.5926250 1.2488953 0.8745921</span>
<span class="co">#&gt; [22] 1.1107180 1.0615729 1.1084070 1.1390382 2.0911556 1.4444998 1.1614853</span>
<span class="co">#&gt; [29] 1.0719210 1.5626260</span>
</pre></div>
</div>
<div id="brier-score" class="section level2">
<h2 class="hasAnchor">
<a href="#brier-score" class="anchor"></a>Brier Score</h2>
<p>The Brier score is a proper score rule that assesses the accuracy of probabilistic binary predictions. The outcomes can be either 0 or 1, the predictions must be a probability that the true outcome will be 1.</p>
<p>The Brier Score is then computed as the mean squared error between the probabilistic prediction and the true outcome.</p>
<p><span class="math display">\[\text{Brier_Score} = \frac{1}{N} \sum_{t = 1}^{n} (\text{prediction}_t - \text{outcome}_t)^2\]</span></p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>), size = <span class="fl">30</span>, replace = <span class="fl">TRUE</span>)
<span class="kw">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(n = <span class="fl">30</span>, min = <span class="fl">0</span>, max = <span class="fl">1</span>)

<span class="fu"><a href="../reference/brier_score.html">brier_score</a></span>(<span class="kw">true_values</span>, <span class="kw">predictions</span>)
<span class="co">#&gt; [1] 0.3190753</span>
</pre></div>
</div>
<div id="interval-score" class="section level2">
<h2 class="hasAnchor">
<a href="#interval-score" class="anchor"></a>Interval Score</h2>
<p>The Interval Score is a Proper Scoring Rule to score quantile predictions, following Gneiting and Raftery (2007). Smaller values are better.</p>
<p>The score is computed as</p>
<p><span class="math display">\[ \text{score} = (\text{upper} - \text{lower}) + \\
\frac{2}{\alpha} \cdot (\text{lower} - \text{true_value}) \cdot 1(\text{true_values} &lt; \text{lower}) + \\
\frac{2}{\alpha} \cdot (\text{true_value} - \text{upper}) \cdot
1(\text{true_value} &gt; \text{upper})\]</span></p>
<p>where <span class="math inline">\(1()\)</span> is the indicator function and <span class="math inline">\(\alpha\)</span> is the decimal value that indicates how much is outside the prediction interval. To improve usability, the user is asked to provide an interval range in percentage terms, i.e. interval_range = 90 (percent) for a 90 percent prediction interval. Correspondingly, the user would have to provide the 5% and 95% quantiles (the corresponding alpha would then be 0.1). No specific distribution is assumed, but the range has to be symmetric (i.e you can’t use the 0.1 quantile as the lower bound and the 0.7 quantile as the upper). Setting <code>weigh = TRUE</code> will weigh the score by <span class="math inline">\(\frac{\alpha}{2}\)</span> such that the Interval Score converges to the CRPS for increasing number of quantiles.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">true_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">30</span>, mean = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>)
<span class="kw">interval_range</span> <span class="op">&lt;-</span> <span class="fl">90</span>
<span class="kw">alpha</span> <span class="op">&lt;-</span> (<span class="fl">100</span> <span class="op">-</span> <span class="kw">interval_range</span>) <span class="op">/</span> <span class="fl">100</span>
<span class="kw">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>(<span class="kw">alpha</span><span class="op">/</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">30</span>, mean = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>))
<span class="kw">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>((<span class="fl">1</span><span class="op">-</span> <span class="kw">alpha</span><span class="op">/</span><span class="fl">2</span>), <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">30</span>, mean = <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>))

<span class="fu"><a href="../reference/interval_score.html">interval_score</a></span>(true_values = <span class="kw">true_values</span>,
               lower = <span class="kw">lower</span>,
               upper = <span class="kw">upper</span>,
               interval_range = <span class="kw">interval_range</span>)
<span class="co">#&gt;  [1]  7.741983  3.537783  3.646091  2.893507  5.454946  3.577673  4.907854</span>
<span class="co">#&gt;  [8]  4.784415  2.148892  4.463388  4.635735  4.338017  3.775047  4.810047</span>
<span class="co">#&gt; [15]  4.121681  4.835442  3.165143  8.448284  4.098572  3.870147  4.037941</span>
<span class="co">#&gt; [22] 37.429858  3.440151  5.410406  3.704982  3.204182 25.617743  4.821099</span>
<span class="co">#&gt; [29]  8.816846  2.177720</span>
</pre></div>
</div>
</div>
<div id="automatically-scoring-forecasts" class="section level1">
<h1 class="hasAnchor">
<a href="#automatically-scoring-forecasts" class="anchor"></a>Automatically Scoring Forecasts</h1>
<p>The function <code>eval_forecasts</code> automatically scores forecasts. As input you need a <code>data.frame</code> with your predictions. You can use the argument <code>by</code> to specify variables over which to group. If you e.g. have one to seven-day-ahead forecasts in three locations made by two different models, you would specify <code>by = c("model", "horizon", "location")</code>. If you want to average over horizons, but not locations, you would specify <code>by = c("model", "horizon")</code>. If you don’t want any groping, you can specify <code>by = NULL</code>. The default grouping variable is <code>"model"</code>. Note that the variables to group over need to be present as columns in the data.</p>
<p>If you want to have one score per observation, you can call the function with the argument <code>summarised = FALSE</code>. The default is <code>summarised = TRUE</code> and the function returns one aggregate score per grouping unit. For more information see <code><a href="../reference/eval_forecasts.html">?eval_forecasts</a></code>.</p>
<p>You can pass down arguments to lower-level functions using <code>...</code>. This could be useful if you e.g. want to weigh the interval score with the argument <code>weigh = TRUE</code>.</p>
<div id="scoring-probability-binary-forecasts" class="section level2">
<h2 class="hasAnchor">
<a href="#scoring-probability-binary-forecasts" class="anchor"></a>Scoring Probability Binary Forecasts</h2>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://r-datatable.com">data.table</a></span>)

<span class="co"># load example data</span>
<span class="kw">binary_example</span> <span class="op">&lt;-</span> <span class="kw">data.table</span>::<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span>(<span class="kw">scoringutils</span>::<span class="kw"><a href="../reference/binary_example_data.html">binary_example_data</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">binary_example</span>, <span class="fl">3</span>, <span class="fl">3</span>)
<span class="co">#&gt;      id true_values  model predictions horizon</span>
<span class="co">#&gt;   1:  1           0 model1 0.877283166       1</span>
<span class="co">#&gt;   2:  2           0 model1 0.858535155       1</span>
<span class="co">#&gt;   3:  3           0 model1 0.639325110       1</span>
<span class="co">#&gt;  ---                                          </span>
<span class="co">#&gt; 238: 28           1 model2 0.127291389       2</span>
<span class="co">#&gt; 239: 29           0 model2 0.004361026       2</span>
<span class="co">#&gt; 240: 30           0 model2 0.356963557       2</span>
</pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="co"># score forecasts</span>
<span class="kw">eval</span> <span class="op">&lt;-</span> <span class="kw">scoringutils</span>::<span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span>(<span class="kw">binary_example</span>, by = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"model"</span>, <span class="st">"horizon"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">eval</span>)
<span class="co">#&gt;     model horizon brier_score</span>
<span class="co">#&gt; 1: model1       1   0.3713748</span>
<span class="co">#&gt; 2: model2       1   0.3254433</span>
<span class="co">#&gt; 3: model1       2   0.3713748</span>
<span class="co">#&gt; 4: model2       2   0.3254433</span>
</pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">eval</span> <span class="op">&lt;-</span> <span class="kw">scoringutils</span>::<span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span>(<span class="kw">binary_example</span>, by = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"model"</span>, <span class="st">"horizon"</span>), 
                                     summarised = <span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">eval</span>, <span class="fl">3</span>, <span class="fl">3</span>)
<span class="co">#&gt;      id true_values  model predictions horizon  brier_score</span>
<span class="co">#&gt;   1:  1           0 model1 0.877283166       1 4.271615e-01</span>
<span class="co">#&gt;   2:  2           0 model1 0.858535155       1 4.090993e-01</span>
<span class="co">#&gt;   3:  3           0 model1 0.639325110       1 2.268590e-01</span>
<span class="co">#&gt;  ---                                                       </span>
<span class="co">#&gt; 238: 28           1 model2 0.127291389       2 6.620760e-01</span>
<span class="co">#&gt; 239: 29           0 model2 0.004361026       2 4.396405e-05</span>
<span class="co">#&gt; 240: 30           0 model2 0.356963557       2 2.945562e-01</span>
</pre></div>
</div>
<div id="scoring-quantile-forecasts" class="section level2">
<h2 class="hasAnchor">
<a href="#scoring-quantile-forecasts" class="anchor"></a>Scoring Quantile Forecasts</h2>
<p>Forecasts can be provided in either long or wide format</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">quantile_example</span> <span class="op">&lt;-</span> <span class="kw">data.table</span>::<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span>(<span class="kw">scoringutils</span>::<span class="kw"><a href="../reference/quantile_example_data_long.html">quantile_example_data_long</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">quantile_example</span>, <span class="fl">3</span>, <span class="fl">3</span>)
<span class="co">#&gt;      true_values id  model predictions boundary range horizon</span>
<span class="co">#&gt;   1:    2.659261  1 model1  -0.6448536    lower    90       1</span>
<span class="co">#&gt;   2:    2.659261  1 model1   0.3255102    lower    50       1</span>
<span class="co">#&gt;   3:    2.659261  1 model1   1.0000000    lower     0       1</span>
<span class="co">#&gt;  ---                                                         </span>
<span class="co">#&gt; 718:   30.189608 30 model2  31.3873685    upper    90       2</span>
<span class="co">#&gt; 719:   30.189608 30 model2  30.6399809    upper    50       2</span>
<span class="co">#&gt; 720:   30.189608 30 model2  31.2576984    upper     0       2</span>

<span class="kw">quantile_example</span> <span class="op">&lt;-</span> <span class="kw">data.table</span>::<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span>(<span class="kw">scoringutils</span>::<span class="kw"><a href="../reference/quantile_example_data_wide.html">quantile_example_data_wide</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">quantile_example</span>, <span class="fl">3</span>, <span class="fl">3</span>)
<span class="co">#&gt;      true_values id  model horizon   lower_0   lower_50   lower_90    upper_0</span>
<span class="co">#&gt;   1:    2.659261  1 model1       1  1.000000  0.3255102 -0.6448536  1.0000000</span>
<span class="co">#&gt;   2:    2.659261  1 model1       2  1.761427 -1.0756255  0.6142077  0.9463843</span>
<span class="co">#&gt;   3:    0.822062  2 model1       1  2.000000  1.3255102  0.3551464  2.0000000</span>
<span class="co">#&gt;  ---                                                                         </span>
<span class="co">#&gt; 118:   29.446186 29 model2       2 29.750094 28.6346711 27.5081858 29.7113944</span>
<span class="co">#&gt; 119:   30.189608 30 model2       1 30.100000 29.4255102 28.4551464 30.1000000</span>
<span class="co">#&gt; 120:   30.189608 30 model2       2 31.224235 29.1650518 28.2025709 31.2576984</span>
<span class="co">#&gt;       upper_50  upper_90</span>
<span class="co">#&gt;   1:  1.674490  2.644854</span>
<span class="co">#&gt;   2:  2.643041  2.354494</span>
<span class="co">#&gt;   3:  2.674490  3.644854</span>
<span class="co">#&gt;  ---                    </span>
<span class="co">#&gt; 118: 29.148724 30.393116</span>
<span class="co">#&gt; 119: 30.774490 31.744854</span>
<span class="co">#&gt; 120: 30.639981 31.387368</span>
</pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">eval</span> <span class="op">&lt;-</span> <span class="kw">scoringutils</span>::<span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span>(<span class="kw">quantile_example</span>, 
                                     by = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"model"</span>, <span class="st">"horizon"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">eval</span>)
<span class="co">#&gt;      model horizon range interval_score calibration      bias sharpness</span>
<span class="co">#&gt;  1: model1       1     0       1.452905   0.0000000 0.0000000  1.348980</span>
<span class="co">#&gt;  2: model1       1    50       2.308918   0.5666667 0.0000000  1.348980</span>
<span class="co">#&gt;  3: model1       1    90       4.055713   0.9000000 0.0000000  1.348980</span>
<span class="co">#&gt;  4: model1       2     0       2.099065   0.2333333 0.2000000  1.086392</span>
<span class="co">#&gt;  5: model1       2    50       3.899553   0.2333333 0.2000000  1.086392</span>
<span class="co">#&gt;  6: model1       2    90       6.576969   0.7333333 0.2000000  1.086392</span>
<span class="co">#&gt;  7: model2       1     0       1.474630   0.0000000 0.2000000  1.348980</span>
<span class="co">#&gt;  8: model2       1    50       2.370549   0.6000000 0.2000000  1.348980</span>
<span class="co">#&gt;  9: model2       1    90       4.179441   0.9333333 0.2000000  1.348980</span>
<span class="co">#&gt; 10: model2       2     0       2.211704   0.1666667 0.2666667  1.504072</span>
<span class="co">#&gt; 11: model2       2    50       3.059459   0.4666667 0.2666667  1.504072</span>
<span class="co">#&gt; 12: model2       2    90       6.707452   0.7666667 0.2666667  1.504072</span>
</pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">eval</span> <span class="op">&lt;-</span> <span class="kw">scoringutils</span>::<span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span>(<span class="kw">quantile_example</span>, summarised = <span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">eval</span>, <span class="fl">3</span>, <span class="fl">3</span>)
<span class="co">#&gt;       model true_values id horizon range      lower     upper interval_score</span>
<span class="co">#&gt;   1: model1    0.822062  2       1     0  2.0000000  2.000000       2.355876</span>
<span class="co">#&gt;   2: model1    0.822062  2       1    50  1.3255102  2.674490       3.362773</span>
<span class="co">#&gt;   3: model1    0.822062  2       1    90  0.3551464  3.644854       3.289707</span>
<span class="co">#&gt;  ---                                                                        </span>
<span class="co">#&gt; 358: model2   30.189608 30       2     0 31.2242353 31.257698       2.102717</span>
<span class="co">#&gt; 359: model2   30.189608 30       2    50 29.1650518 30.639981       1.474929</span>
<span class="co">#&gt; 360: model2   30.189608 30       2    90 28.2025709 31.387368       3.184798</span>
<span class="co">#&gt;      calibration      bias sharpness</span>
<span class="co">#&gt;   1:  0.11666667 0.1000000  1.217686</span>
<span class="co">#&gt;   2:  0.40000000 0.1000000  1.217686</span>
<span class="co">#&gt;   3:  0.81666667 0.1000000  1.217686</span>
<span class="co">#&gt;  ---                                </span>
<span class="co">#&gt; 358:  0.08333333 0.2333333  1.426526</span>
<span class="co">#&gt; 359:  0.53333333 0.2333333  1.426526</span>
<span class="co">#&gt; 360:  0.85000000 0.2333333  1.426526</span>
</pre></div>
</div>
<div id="scoring-integer-forecasts" class="section level2">
<h2 class="hasAnchor">
<a href="#scoring-integer-forecasts" class="anchor"></a>Scoring Integer Forecasts</h2>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">integer_example</span> <span class="op">&lt;-</span> <span class="kw">data.table</span>::<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span>(<span class="kw">scoringutils</span>::<span class="kw"><a href="../reference/integer_example_data.html">integer_example_data</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">integer_example</span>, <span class="fl">3</span>, <span class="fl">3</span>)
<span class="co">#&gt;       id  model true_values sample  predictions horizon</span>
<span class="co">#&gt;    1:  1 model1  -0.0544862      1 -0.280285410       1</span>
<span class="co">#&gt;    2:  1 model1  -0.0544862      2 -0.249304345       1</span>
<span class="co">#&gt;    3:  1 model1  -0.0544862      3 -2.333502887       1</span>
<span class="co">#&gt;   ---                                                  </span>
<span class="co">#&gt; 5998: 30 model2  -2.8857563     48  0.006200076       2</span>
<span class="co">#&gt; 5999: 30 model2  -2.8857563     49 -0.823159952       2</span>
<span class="co">#&gt; 6000: 30 model2  -2.8857563     50  0.144799618       2</span>
</pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">eval</span> <span class="op">&lt;-</span> <span class="kw">scoringutils</span>::<span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span>(<span class="kw">integer_example</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">eval</span>)
<span class="co">#&gt;     model sharpness       bias      dss      crps log_score pit_p_val</span>
<span class="co">#&gt; 1: model1  1.317615 0.03666667 1.523662 0.7446134  1.696009     1e-05</span>
<span class="co">#&gt; 2: model2  1.304324 0.09333333 1.490664 0.7309500  1.680580     1e-05</span>
</pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw">eval</span> <span class="op">&lt;-</span> <span class="kw">scoringutils</span>::<span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span>(<span class="kw">integer_example</span>, 
                                     by = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"model"</span>, <span class="st">"horizon"</span>), 
                                     summarised = <span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">eval</span>, <span class="fl">3</span>, <span class="fl">3</span>)
<span class="co">#&gt;      id  model horizon sharpness bias       dss      crps log_score pit_p_val</span>
<span class="co">#&gt;   1:  1 model1       1 1.0647367 0.16 0.1991422 0.2798130  1.117307 0.0000200</span>
<span class="co">#&gt;   2:  1 model1       2 1.4879071 0.24 1.1571633 0.3843684  1.390011 0.3961767</span>
<span class="co">#&gt;   3:  1 model2       1 0.9990985 0.04 0.3412739 0.2656275  1.041807 0.0000200</span>
<span class="co">#&gt;  ---                                                                         </span>
<span class="co">#&gt; 118: 30 model1       2 1.7717634 0.96 5.5227637 2.5435834  3.204653 0.3961767</span>
<span class="co">#&gt; 119: 30 model2       1 1.2238645 0.96 5.2024108 2.0936593  3.272516 0.0000200</span>
<span class="co">#&gt; 120: 30 model2       2 1.6027247 1.00 6.0253461 2.8231597  4.113908 0.0000200</span>
</pre></div>
</div>
<div id="scoring-continuous-forecasts" class="section level2">
<h2 class="hasAnchor">
<a href="#scoring-continuous-forecasts" class="anchor"></a>Scoring Continuous Forecasts</h2>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="kw">continuous_example</span> <span class="op">&lt;-</span> <span class="kw">data.table</span>::<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span>(<span class="kw">scoringutils</span>::<span class="kw"><a href="../reference/continuous_example_data.html">continuous_example_data</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">continuous_example</span>, <span class="fl">3</span>, <span class="fl">3</span>)
<span class="co">#&gt;       id  model true_values sample  predictions horizon</span>
<span class="co">#&gt;    1:  1 model1  0.03007379      1 -0.203426069       1</span>
<span class="co">#&gt;    2:  1 model1  0.03007379      2  0.007621269       1</span>
<span class="co">#&gt;    3:  1 model1  0.03007379      3 -2.086657003       1</span>
<span class="co">#&gt;   ---                                                  </span>
<span class="co">#&gt; 5998: 30 model2 -2.93749990     48 -0.079900522       2</span>
<span class="co">#&gt; 5999: 30 model2 -2.93749990     49 -1.178524017       2</span>
<span class="co">#&gt; 6000: 30 model2 -2.93749990     50  0.638750918       2</span>
</pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="kw">eval</span> <span class="op">&lt;-</span> <span class="kw">scoringutils</span>::<span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span>(<span class="kw">continuous_example</span>, 
                                     by = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"model"</span>, <span class="st">"horizon"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">eval</span>)
<span class="co">#&gt;     model horizon sharpness         bias      dss      crps log_score pit_p_val</span>
<span class="co">#&gt; 1: model1       1 0.9614030 -0.070666667 1.728001 0.7596405  1.826296 0.0000200</span>
<span class="co">#&gt; 2: model1       2 1.3906148  0.121333333 1.568987 0.7609775  1.695719 0.4685122</span>
<span class="co">#&gt; 3: model2       1 0.9640941 -0.006666667 1.624224 0.7417875  1.804958 0.0000200</span>
<span class="co">#&gt; 4: model2       2 1.3895440  0.210666667 1.622202 0.7849479  1.786270 0.0000200</span>
</pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw">eval</span> <span class="op">&lt;-</span> <span class="kw">scoringutils</span>::<span class="fu"><a href="../reference/eval_forecasts.html">eval_forecasts</a></span>(<span class="kw">continuous_example</span>, summarised = <span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">eval</span>, <span class="fl">3</span>, <span class="fl">3</span>)
<span class="co">#&gt;     id  model sharpness  bias       dss      crps log_score pit_p_val</span>
<span class="co">#&gt;  1:  1 model1  1.185493  0.16 0.5614518 0.3129851  1.197843     1e-05</span>
<span class="co">#&gt;  2:  1 model2  1.448440  0.10 0.7019383 0.3423513  1.341006     1e-05</span>
<span class="co">#&gt;  3:  2 model1  1.108629 -0.82 2.0689850 1.0406655  2.141136     1e-05</span>
<span class="co">#&gt; ---                                                                  </span>
<span class="co">#&gt; 58: 29 model2  1.151130 -0.52 0.6299222 0.4925379  1.362165     1e-05</span>
<span class="co">#&gt; 59: 30 model1  1.308443  0.98 6.6463525 2.4810280  3.566925     1e-05</span>
<span class="co">#&gt; 60: 30 model2  1.168957  0.98 6.1569316 2.5530186  3.710886     1e-05</span>
</pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nikos Bosse, Sam Abbott, Sebastian Funk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
